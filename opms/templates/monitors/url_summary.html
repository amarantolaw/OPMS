{% extends "monitors/base.html" %}
{% load static %}
{% get_static_prefix as STATIC_PREFIX %}

{% block scripts %}
    <script src="{{ STATIC_PREFIX }}scripts/jquery.tablesorter.min.js"></script>
    <script src="{{ STATIC_PREFIX }}scripts/jquery-ui-1.8.13.min.js"></script>
{% endblock %}

{% block content %}
<h2>URL Reporting</h2>
{%  if summary_listing %}
<p>The following URLs have been scanned by this system:</p>
<ul>
    {% for item in summary_listing %}
    <li>{{ item|safe }}</li>
    {% endfor %}
</ul>
{% endif %}

{% if scan_data %}
<h3>Data visualisation</h3>
<script>
$(document).ready(function()
    {
        $("#summaryTable").tablesorter( {sortList: [[0,1]]} );
    }
);
</script>

{% if url_id %}
<p>Legend: Blue Dots = TTFB; Red Crosses = TTLB; Lightest colours represent the first iteration of each scan<br />
    <img src="./graph/url_by_time/{{ url_id }}.png" /><br />
    <a href="./graph/url_by_time/{{ url_id }}.png?dpi=300">[Print Version]</a> <a href="./graph/url_by_time/{{ url_id }}.png?dpi=600">[High Resolution]</a></p>
{% endif %}

<table id="summaryTable" class="tablesorter">
    <thead>
        <tr>
            <th>Task Comment</th>
            <th>URL</th>
            <th>Iteration</th>
            <th>Time of Request</th>
            <th>Status Code</th>
            <th>TTFB</th>
            <th>TTLB</th>
        </tr>
    </thead>
    <tbody>
    {% for row in scan_data %}
        <tr>
            <td><a href="./task-{{ row.task.id }}">{{ row.task.id }}</a>:{{ row.task.comment }}</td>
            <td><a href="./url-{{ row.url.id }}">{{ row.url.url }}</a></td>
            <td>{{ row.iteration }}</td>
            <td>{{ row.time_of_request|date:"Y-m-d H:i:s" }}</td>
            <td class="{% if row.status_code == 200 %}positive{% else %}negative{% endif %}">{{ row.status_code }}</td>
            <td class="{% if row.ttfb < 0.5 %}positive{% else %}negative{% endif %}">{{ row.ttfb }}</td>
            <td class="{% if row.ttlb < 0.5 %}positive{% else %}negative{% endif %}">{{ row.ttlb }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endif %}

{% endblock %}