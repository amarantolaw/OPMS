{% extends "stats/base.html" %}
{% block head %}
    <script src="/static/scripts/jquery-1.6.4.min.js"></script>
    <script src="/static/scripts/jquery.tablesorter.min.js"></script>
    <script src="/static/scripts/jquery-ui-1.8.13.min.js"></script>
{% endblock %}

{% block title %}Summary Data from URL Monitoring{% endblock %}

{% block navbar %}
<div id="mainnav">
    <h2>Main sections</h2>
    <ul class="level-1">
        <li><a href="/">Home</a></li>
        <li><a href="/admin/">Admin</a></li>
        <li><a href="/ffm/">Files &amp; Feeds</a></li>
        <li><a href="/stats/" class="currentsection">Statistics</a></li>
    </ul>
</div>
<div id="mainnav2">
    <h3>Sub sections for Statistics</h3>
    <ul class="level-2">
        <li><span class="youarehere">URL Monitoring</span></li>
        <li><a href="/stats/report/summary/">Summary</a></li>
        <li><a href="/stats/report/summary/feeds/">Feeds</a></li>
    </ul>
</div>
{% endblock %}

{% block breadcrumb %}&gt; <a href="/stats/">Statistics</a> &gt; <a href="/stats/report/urlmonitoring/">URL Monitoring Summary</a>{% endblock %}

{% block content %}
<h2>URL Reporting</h2>
{%  if summary_listing %}
<p>The following URLs have been scanned by this system:</p>
<ul>
    {% for item in summary_listing %}
    <li>{{ item|safe }}</li>
    {% endfor %}
</ul>
{% endif %}

{% if summary_data %}
<script>
$(document).ready(function()
    {
        $("#summaryTable").tablesorter( {sortList: [[0,1]]} );
    }
);
</script>

<h3>Data table</h3>
<p>Display with columns of: <a href="?orientation=0">Tasks</a> or <a href="?orientation=1">URLs</a></p>
<table id="summaryTable" class="tablesorter">
    <thead>
        {% for row in summary_data %}
        {% if forloop.counter0 == 0 %}
        <tr>
            <th>{{ row.url|default:"URLs" }}</th>
            {% for item in row.data %}
            <th>{{ item|safe }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% endif %}
        {% if forloop.counter0 > 0 %}
        <tr>
            <td>{{ row.url|safe }}</td>
            {% for item in row.data %}
            <td>{{ item }}</td>
            {% endfor %}
        </tr>
        {% endif %}
        {% endfor %}
    </tbody>
</table>
{% endif %}

{% if scan_data %}
<h3>Data visualisation</h3>
<script>
$(document).ready(function()
    {
        $("#summaryTable").tablesorter( {sortList: [[0,1]]} );
    }
);
</script>
{% if url_id %}
<p><img src="/stats/graph/urlmonitoring/url_by_time/{{ url_id }}.png" /><br />
    <a href="/stats/graph/urlmonitoring/url_by_time/{{ url_id }}.png?dpi=300">[Print Version]</a> <a href="/stats/graph/urlmonitoring/url_by_time/{{ url_id }}.png?dpi=600">[High Resolution]</a></p>
{% endif %}

<table id="summaryTable" class="tablesorter">
    <thead>
        <tr>
            <th>Task Comment</th>
            <th>URL</th>
            <th>Iteration</th>
            <th>Time of Request</th>
            <th>Status Code</th>
            <th>TTFB</th>
            <th>TTLB</th>
        </tr>
    </thead>
    <tbody>
    {% for row in scan_data %}
        <tr>
            <td><a href="/stats/report/urlmonitoring/task/{{ row.task.id }}">{{ row.task.id }}</a>:{{ row.task.comment }}</td>
            <td><a href="/stats/report/urlmonitoring/url/{{ row.url.id }}">{{ row.url.url }}</a></td>
            <td>{{ row.iteration }}</td>
            <td>{{ row.time_of_request|date:"Y-m-d h:i:s" }}</td>
            <td class="{% if row.status_code == 200 %}positive{% else %}negative{% endif %}">{{ row.status_code }}</td>
            <td class="{% if row.ttfb < 0.5 %}positive{% else %}negative{% endif %}">{{ row.ttfb }}</td>
            <td class="{% if row.ttlb < 0.5 %}positive{% else %}negative{% endif %}">{{ row.ttlb }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endif %}

{% endblock %}